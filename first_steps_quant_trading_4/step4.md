We will now be putting together our second strategy!

Create a signal in an `sma_signal` column when the short moving average crosses the long moving average, but only for the period greater than the shortest moving average window. We will need to use 'np.where()' function to compare all the rows after the (short_window)th index row. Hence, we use iloc inside the 'np.where()' function. If true (i.e., short MA value is more than long MA value), the initialized value 0.0 in the signal column will be overwitten with 1.0. A “signal” is created! If the condition is false, the original value of 0.0 will be kept and no signal is generated.

We will also be overwriting the 'sma_positions' column with the difference of the current signal values minus the previous signal value through the 'diff()' method. This will result in +1 whenever the short MA crosses above the long MA, -1 whenever the short MA crosses below the long MA and 0 elsewhere.

Open `step1.py`{{open}}  in the editor.

<pre class="file" data-filename="step4.py" data-target="append">
# Create signals in the same way we did so in step 3, but this time we assign 1 as a signal whenever the short
# MA is above the long MA

# Since we are using iloc, we need to specify the integer values of the columns. 3, 4 and 5 correspond to the
# 'sma_signal', 'short_mavg' and 'long_mavg' respectively
signals.iloc[short_window:,3] = np.where(signals.iloc[short_window:,4] 
                                            > signals.iloc[short_window:,5], 1.0, 0.0)

# Creating trading orders similar to how we did so in step 3
signals['sma_positions'] = signals['sma_signal'].diff()
print(signals)
</pre>

Now, that the positions are generated, let's plot them to check our positions over the years

<pre class="file" data-filename="step4.py" data-target="append">
# Initialize the plot figure
fig = plt.figure(figsize=(12,10))

# Add a subplot and label for y-axis
ax1 = fig.add_subplot(111,  ylabel='Price in $')

# Plot the closing price
df['Close'].plot(ax=ax1, color='r', lw=2.,label='Close Price')

# Plot the short and long moving averages
signals[['short_mavg', 'long_mavg',]].plot(ax=ax1, lw=2.)

# Plot the buy signals
ax1.plot(signals.loc[signals.sma_positions == 1.0].index, 
         signals.short_mavg[signals.sma_positions == 1.0],
         '^', markersize=10, color='g')
         
# Plot the sell signals
ax1.plot(signals.loc[signals.sma_positions == -1.0].index, 
         signals.short_mavg[signals.sma_positions == -1.0],
         'o', markersize=10, color='r')

plt.legend()

fig.savefig('strategy_2_signals.png')
</pre>

```
python step1.py

```{{execute}}

Run the script to notice the changes in the `sma_signal` and `sma_positions` columns and visualize the signals generated by opening `strategy_2_signals.png`{{open}}.