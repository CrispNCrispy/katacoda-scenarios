We will now be putting together our first strategy!

Create a signal in an `ema_signal` column when the price crosses the exponential moving average. We will need to use `np.where()` to compare the rows of the EMA values vs. the Close values. If true (i.e., close price higher than EMA), the initialized value 0.0 in the signal column will be overwitten with 1.0. A “signal” is created! If the condition is false, the original value of 0.0 will be kept and no signal is generated.

We will also be overwriting the `ema_positions` column with the difference of the current signal values minus the previous signal value through the `diff()` method. This will result in +1 whenever the price crosses above the EMA, -1 whenever the price crosses below the EMA and 0 elsewhere.

Open `step1.py`{{open}}  in the editor.

<pre class="file" data-filename="step4.py" data-target="append">
# Change signal values to 1 whenever it is above the price
signals['ema_signal'] = np.where(signals['ema'] > df['Close'], 1.0, 0.0)

# Calculate the position values. Whenever the signal changes from 0 to 1, we will obtain a value of +1
# Whenever the signal changes from 1 to 0, we will obtain a value of -1
signals['ema_positions'] = signals['ema_signal'].diff()

print(signals)
</pre>

With all our values ready, we can now plot our first strategy.

<pre class="file" data-filename="step4.py" data-target="append">
# Initialize the plot figure
fig = plt.figure(figsize=(12,10))

# Add a subplot and label for y-axis
ax1 = fig.add_subplot(111,  ylabel='Price in $')

#Make a subset of signals from January 2018 for clearer visualization
signals2 = signals.loc['2018-01-01':,:]

# Plot the closing price
df.loc['2018-01-01':,'Close'].plot(ax=ax1, color='r', lw=2.,label='Close Price')

# Plot the short and long moving averages
signals2.loc[:,'ema'].plot(ax=ax1, lw=2.)

# Plot the buy signals
ax1.plot(signals2.loc[signals2.ema_positions == 1.0].index, 
         signals2.ema[signals2.ema_positions == 1.0],
         'o', markersize=10, color='r')
         
# Plot the sell signals
ax1.plot(signals2.loc[signals2.ema_positions == -1.0].index, 
         signals2.ema[signals2.ema_positions == -1.0],
         '^', markersize=10, color='g')

plt.legend()

fig.savefig('strategy_1_signals.png')
</pre>

```
python step1.py

```{{execute}}

Run the script to notice the changes in the `ema_signal` and `ema_positions` columns and visualize the signals generated by opening `strategy_1_signals.png`{{open}}.